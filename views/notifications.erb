<%= partial 'partials/masthead' %>

<div class="grid">
    <h2 class="ta">Activity</h2>
    <div id="cal-heatmap"></div>
    <div id="cal-heatmap-placeholder"></div>

    <script type="text/javascript">
        var cal = new CalHeatMap();
        cal.init({
            start: new Date(<%= (Time.now - 28927200).to_json %>),
            range: 12,
            domain: "month",
            subDomain: "day",
            data: <%= @statistics.to_json %>,
            onClick: function(date, nb) {
                var format = d3.time.format("%A %B %d, %Y");

                $("#cal-heatmap-placeholder").html("<b>" +
                    (nb === null ? 0 : nb) + "</b> activities, " +
                    format(new Date(date))
                );
            }
        });
    </script>

    <h2 class="ta">Notifications</h2>
    <ol class="notifications">
<% unless @notifications.nil? || @notifications.count == 0  %>
    <% for notification in @notifications %>
    <% notification = notification.scan(/\d+|\D+/) %>
    <% story = Story.find(notification[0].to_i) %>
        <li>
            <div class="left">
                <span class="link">
                    <a href="/s/<%= notification[0].to_i.to_s(32) %>"><%= story.description %></a>
                </span>
                by
                <a href="/u/<%= story.user.username %>"><%= story.user.username %></a>
            </div>
            <div class="right">
                <%= Netflam::Notification.type(notification[1]) %>
            </div>
        </li>
    <% end %>
    </ol>
<% else %>
    <div class="box">
        Nothing to show!
    </div>
<% end %>
</div>

<%= partial 'partials/footer' %>